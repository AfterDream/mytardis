{% extends "tardis_portal/portal_template.html" %}
{% load url from future %}
{% load experiment_tags %}
{% load experimentstats %}
{% load humanize %}

{% block content %}

<div id="content">
  <div class="pull-right">
    {% if perms.tardis_portal.add_experiment %}
    <a class="btn btn-warning"
       href="{% url 'tardis.tardis_portal.views.create_experiment' %}">
      <i class="icon-plus"></i>
      Create
    </a>
    {% endif %}
    <a class="btn btn-primary"
       href="{% url 'tardis.tardis_portal.views.search_experiment' %}">
      <i class="icon-search"></i>
       Search
    </a>
  </div>
  {% if user.is_authenticated %}
  <h2>My Experiments</h2>

	{% if experiments %}
		<table class="experiment-table table">
			<thead>
				<tr>
					<th>
						<strong>{{ experiments.count }}</strong>
						experiment{{ experiments.count|pluralize}}
					</th>
				</tr>
			</thead>
			<tbody>
			  {% for experiment in experiments %}
        <tr>
					<td>
            {% experiment_browse_item experiment can_download=1 %}
					</td>
			  </tr>
			{% endfor %}
			</tbody>
		</table>
	{% else %}
	  <p>You own no experiments at this time.</p>
	{% endif %}

  <h2>Experiments shared with me</h2>

  {% if shared_experiments %}
	<table class="experiment-table table">
    <thead>
	    <tr>
	        <th>
				      <strong>{{ shared_experiments.count }}</strong>
				      experiment{{ shared_experiments.count|pluralize}}
	        </th>
	    </tr>
    </thead>
    <tbody>
    {% for experiment in shared_experiments %}
      <tr>
        <td>
          {% experiment_browse_item experiment can_download=1 %}
				</td>
      </tr>
    </tbody>
	  {% endfor %}
	</table>
	{% else %}
	<p class="alert alert-info">There are no experiments shared with you.</p>
	{% endif %}

{% endif %}

  <h2>Public Experiments</h2>

{% if public_experiments %}
	<table class="experiment-table table">
	  <thead>
	    <tr>
	      <th>
		      <strong>{{ public_experiments.count }}</strong>
		      public experiment{{ public_experiments.count|pluralize }}
		    </th>
		  </tr>
		</thead>
	  <tbody>
	  {% for public_experiment in public_experiments %}
		  <tr>
		    <td>
		      {% experiment_browse_item public_experiment %}
        </td>
		  </tr>
	  {% endfor %}
    </tbody>
  </table>
{% else %}
  <p class="alert alert-info">No public experiments at the moment.</p>
{% endif %}

<script type="text/javascript">
// Set up tables cells as click links for touch devices
$(function() {
  $('.experiment-table a.experiment-link').click(function(evt) {
    window.location.href = $(evt.delegateTarget).attr('href');
  });
	$('.experiment-table td').click(function(evt) {
	  if (evt.target.tagName != 'A') {
	    $(evt.delegateTarget).find('a.experiment-link').click();
	  }
	}).addClass('experiment-clickable');
});
</script>

</div> <!-- content -->

{% endblock %}
