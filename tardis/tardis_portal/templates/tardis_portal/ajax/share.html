{% load static from staticfiles %}
{% load url from future %}
{% load experiment_tags %}
{% block script %}
<script type="text/javascript">
$('.public_access_link').live('click', function(evt) {
    var experiment_id = $(this).attr('data-experiment_id');
    var modal = $('#modal-public-access');


    modal.find('.modal-body').html('');
    modal.find('.loading-placeholder').show();
    modal.modal('show');

    modal.find('.modal-body')
         .load("/ajax/experiment/" + experiment_id + "/rights", function() {
            modal.find('.loading-placeholder').hide();
            $('#legal-section').hide();
            // modal.modal('hide');
        });
       
});

$('#modal-public-access').bind('hidden', function () {
  $('.tab-pane').trigger('experiment-change');
});

$('.copylink').live('click', function(evt)
{
    $(this).focus();
    $(this).select();
});

// user access list
$(document).ready(function() {
  var $target = $("#experiment_user_list");
  $target.html(loadingHTML + "</br>");
  var href = "/experiment/control_panel/{{experiment.id}}/access_list/user/readonly/"
  $target.load(href);
 });
</script>
{% endblock %}
{% block content %}

<!-- Scripts -->
{% load mustachejs %}
{% mustachejs "tardis_portal/license_selector" %}
{% mustachejs "tardis_portal/rights_update_message" %}
{% mustachejs "tardis_portal/ajax_error" %}

<!-- public access modal !-->
<div class="modal hide fade" id="modal-public-access">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">&times;</a>
    <h1 class="title">Public Access</h1>
  </div>

  <div class="loading-placeholder" style="display: none">
    <p>Please wait... <img src="{% static 'images/ajax-loader.gif'%}" alt="loading" /></p>
  </div>

  <div class="modal-body"></div>

</div>

<div class="sharing-sections">
    <div class="sharing-section public-access">
    <h3>Public Access</h3>
        <p>
            <dl>
              <dt>Current Public Access Settings</dt>
              <dd style="padding-top: 5px;">
                {{ experiment|experiment_public_access_badge }}
              </dd>
            </dl>            
            <dl>
              <dt>Current License</dt>
              <dd>
                {% if experiment.license_id %}
                  <div class="row-fluid">
                    <div class="span6">
                      This experiment data is licensed under
                      <a rel="license"
                         property="dc:license"
                         href="{{ experiment.license.url }}">
                        {{ experiment.license.name }}</a>.
                    </div>
                    {% if experiment.license.image_url != None %}
                    <div class="span6">
                      <img src="{{ experiment.license.image_url }}"/>
                    </div>
                    {% endif %}
                  </div>
                {% else %}
                  <abbr title="All rights reserved">
                    Unspecified
                  </abbr>
                {% endif %}
              </dd>
            </dl>
        </p>
        <a data-experiment_id="{{experiment.id}}" class="public_access_link btn btn-primary" title="Change">
          <i class="icon-cog"></i>
          Change
        </a>
    </div>
    <hr/>
    <div class="sharing-section sharing">
    <h3>User and Group Sharing</h3>
    <p>These users etc..</p>
    <div id="experiment_user_list"/>
        <!-- <ul>
            <li><strong>Steve Androulakis</strong></li>
            <li><strong>Bob Jones</strong></li>        
        </ul> -->
        <button type="submit" class="btn btn-primary">
          <i class="icon-share"></i>
          Change
        </button>
    </div>
    <hr/>
    <div class="sharing-section sharing">
    <h3>Links</h3>
    <p>This experiment can be accessed by everybody with the link below:
        <input class="copylink span9" value="http://www.mytardis.org/XOJWE25"
            readonly="readonly"></p>
    <br/>
    <p>Temporary access links exist for this experiment:</p>
    <table class="table table-striped">
        <tr>
            <tr>
                <th style="width: 60%;">
                    Link
                </th>
                <th>
                    Expiry
                </th>
                <th>
                    Remove
                </th>                
            </tr>
            <td>
                <input class="copylink span12" value="http://www.mytardis.org/XOJWE25"
                    readonly="readonly"
                    >  
            </td>
            <td>
                29th July, 2012
            </td>  
            <td>
                [x]
            </td>            
        </tr>
        <tr>
            <td>
                <input class="copylink span12" value="http://www.mytardis.org/XOJWE25"
                    readonly="readonly"
                    > 
            </td>
            <td>
                29th July, 2012
            </td> 
            <td>
                [x]
            </td>                                 
        </tr>      
    </table>
    <button type="submit" class="btn btn-primary">
        Create New Temporary Link      
    </button>
    </div>
    <hr/>
    <div class="sharing-section sharing">
    <h3>Feeds</h3>
    <p>Data feeds for this experiment exist:</p>
    <table class="table table-striped">
        <tr>
            <tr>
                <th>Name</th>
                <th style="width: 60%;">
                    Link
                </th>               
            </tr>
                <td>OAI-DC</td>            
                <td>
                    <input class="copylink span12" value="http://www.mytardis.org/XOJWE25"
                        readonly="readonly"
                        >  
                </td>         
        </tr>
        <tr>
            <td>RIF-CS</td>
            <td>
                <input class="copylink span12" value="http://www.mytardis.org/XOJWE25"
                    readonly="readonly"
                    > 
            </td>                               
        </tr>      
    </table>
    </div>      
</div>

{% endblock %}

